!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(e.ol||(e.ol={})).Photon=t()}}(function(){return function t(e,i,n){function s(r,a){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(o)return o(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[r]={exports:{}};e[r][0].call(l.exports,function(t){var i=e[r][1][t];return s(i?i:t)},l,l.exports,t,e,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(t,e){var i,n=Object.prototype.hasOwnProperty,s=Object.prototype.toString,o=function(t){"use strict";if(!t||"[object Object]"!==s.call(t))return!1;var e=n.call(t,"constructor"),o=t.constructor&&t.constructor.prototype&&n.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!e&&!o)return!1;var r;for(r in t);return r===i||n.call(t,r)};e.exports=function r(){"use strict";var t,e,n,s,a,h,u=arguments[0],l=1,c=arguments.length,p=!1;for("boolean"==typeof u?(p=u,u=arguments[1]||{},l=2):("object"!=typeof u&&"function"!=typeof u||null==u)&&(u={});c>l;++l)if(t=arguments[l],null!=t)for(e in t)n=u[e],s=t[e],u!==s&&(p&&s&&(o(s)||(a=Array.isArray(s)))?(a?(a=!1,h=n&&Array.isArray(n)?n:[]):h=n&&o(n)?n:{},u[e]=r(p,h,s)):s!==i&&(u[e]=s));return u}},{}],2:[function(t,e){"use strict";var i=t("extend"),n=t("./utils"),s=function(){};s.prototype.forEach=function(t,e){Array.prototype.forEach.call(t,e)},s.prototype.ajax=function(t,e){"object"==typeof this.xhr&&this.xhr.abort(),this.xhr=new XMLHttpRequest,this.xhr.open("GET",this.options.url+this.buildQueryString(this.getParams()),!0),this.xhr.onload=function(){var i=new Event("ajax:return");if(document.dispatchEvent(i),200===this.status&&t){var n=this.response;n=JSON.parse(n),t.call(e||this,n)}delete this.xhr};var i=new Event("ajax:send");document.dispatchEvent(i),this.xhr.send()},s.prototype.buildQueryString=function(t){var e=[];for(var i in t)t[i]&&e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e.join("&")},s.prototype.featureToPopupContent=function(t){var e=n.dom.create("div","ol-photon-popup"),i=n.dom.create("h3","",e);return i.innerHTML=t.properties.label,e};var o=function(t,e){{var o=i({},s.prototype,{options:{url:"http://photon.komoot.de/api/?",placeholder:"Start typing...",minChar:3,limit:5,submitDelay:300,includePosition:!0,noResultLabel:"No result",feedbackEmail:"photon@komoot.de"},CACHE:"",RESULTS:[],KEYS:{LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,RETURN:13,ESC:27,APPLE:91,SHIFT:16,ALT:17,CTRL:18},initialize:function(t,e,n){this.map=t,this.input=e,this.options=i({},this.options,n);var s=null;try{Object.defineProperty(this,"CURRENT",{get:function(){return s},set:function(t){"object"==typeof t&&(t=this.resultToIndex(t)),s=t}})}catch(o){}this.input.type="search",this.input.placeholder=this.options.placeholder,this.input.autocomplete="off",this.input.autocorrect="off",this.input.addEventListener("keydown",this.onKeyDown.bind(this),!1),this.input.addEventListener("input",this.onInput.bind(this),!1),this.input.addEventListener("blur",this.onBlur.bind(this),!1),this.input.addEventListener("focus",this.onFocus.bind(this),!1),this.createResultsContainer()},createResultsContainer:function(){this.resultsContainer=n.dom.create("ul","photon-autocomplete",document.querySelector("body"))},resizeContainer:function(){var t=this.getLeft(this.input),e=this.getTop(this.input)+this.input.offsetHeight;this.resultsContainer.style.left=t+"px",this.resultsContainer.style.top=e+"px";var i;i=this.options.width?this.options.width:this.input.offsetWidth-2,this.resultsContainer.style.width=i+"px"},onKeyDown:function(t){switch(t.keyCode){case this.KEYS.TAB:null!==this.CURRENT&&this.setChoice(),n.evt.stop(t);break;case this.KEYS.RETURN:n.evt.stop(t),this.setChoice();break;case this.KEYS.ESC:n.evt.stop(t),this.hide(),this.input.blur();break;case this.KEYS.DOWN:this.RESULTS.length>0&&(null!==this.CURRENT&&this.CURRENT<this.RESULTS.length-1?(this.CURRENT++,this.highlight()):null===this.CURRENT&&(this.CURRENT=0,this.highlight()));break;case this.KEYS.UP:null!==this.CURRENT&&n.evt.stop(t),this.RESULTS.length>0&&(this.CURRENT>0?(this.CURRENT--,this.highlight()):0===this.CURRENT&&(this.CURRENT=null,this.highlight()))}},onInput:function(){"number"==typeof this.submitDelay&&(window.clearTimeout(this.submitDelay),delete this.submitDelay),this.submitDelay=window.setTimeout(this.search.bind(this),this.options.submitDelay)},onBlur:function(){var t=new Event("blur");document.dispatchEvent(t),setTimeout(function(){this.hide()}.bind(this),100)},onFocus:function(){var t=new Event("focus");document.dispatchEvent(t),this.input.select(),this.search()},clear:function(){this.RESULTS=[],this.CURRENT=null,this.CACHE="",this.resultsContainer.innerHTML=""},hide:function(){var t=new Event("hide");document.dispatchEvent(t),this.clear(),this.resultsContainer.style.display="none"},setChoice:function(t){if(t=t||this.RESULTS[this.CURRENT]){this.hide(),this.input.value="";var e=new CustomEvent("selected",{choice:t.feature});document.dispatchEvent(e),this.onSelected(t.feature)}},search:function(){var t,e=this.input.value;return t="function"==typeof this.options.minChar?this.options.minChar(e):e.length>=this.options.minChar,e&&t?void(e+""!=this.CACHE+""&&(this.CACHE=e,this._doSearch())):this.clear()},_doSearch:function(){this.ajax(this.handleResults,this)},_onSelected:function(e){var i=ol.proj.transform([e.geometry.coordinates[0],e.geometry.coordinates[1]],"EPSG:4326",t.getView().getProjection());t.getView().setCenter(i),t.getView().setZoom(16)},onSelected:function(t){return(this.options.onSelected||this._onSelected).call(this,t)},_formatResult:function(t,e){var i=n.dom.create("strong","",e),s=n.dom.create("small","",e),o=[],r=this.formatType(t);i.innerHTML=t.properties.name,r&&o.push(r),t.properties.city&&t.properties.city!==t.properties.name&&o.push(t.properties.city),t.properties.country&&o.push(t.properties.country),s.innerHTML=o.join(", ")},formatResult:function(t,e){return(this.options.formatResult||this._formatResult).call(this,t,e)},formatType:function(t){return(this.options.formatType||this._formatType).call(this,t)},_formatType:function(t){return t.properties.osm_value},createResult:function(t){var e=n.dom.create("li","",this.resultsContainer);this.formatResult(t,e);var i={feature:t,el:e};return e.addEventListener("mouseover",function(){this.CURRENT=i,this.highlight()}.bind(this),!1),e.addEventListener("mousedown",function(){this.setChoice()}.bind(this)),i},resultToIndex:function(t){var e=null;return this.forEach(this.RESULTS,function(i,n){return i===t?void(e=n):void 0}),e},handleResults:function(t){if(this.clear(),this.resultsContainer.style.display="block",this.resizeContainer(),this.forEach(t.features,function(t){this.RESULTS.push(this.createResult(t))}.bind(this)),0===t.features.length){var e=n.dom.create("li","photon-no-result",this.resultsContainer);e.innerHTML=this.options.noResultLabel}if(this.options.feedbackEmail){var i=n.dom.create("a","photon-feedback",this.resultsContainer);i.href="mailto:"+this.options.feedbackEmail,i.innerHTML="Feedback"}this.CURRENT=0,this.highlight(),this.options.resultsHandler&&this.options.resultsHandler(t)},highlight:function(){this.forEach(this.RESULTS,function(t,e){e===this.CURRENT?n.dom.addClass(t.el,"on"):n.dom.removeClass(t.el,"on")}.bind(this))},getLeft:function(t){var e=t.offsetLeft;for(t=t.offsetParent;t;)e+=t.offsetLeft,t=t.offsetParent;return e},getTop:function(t){var e=t.offsetTop;for(t=t.offsetParent;t;)e+=t.offsetTop,t=t.offsetParent;return e},getParams:function(){var t,e;if(this.options.includePosition){var i=ol.proj.transform(this.map.getView().getCenter(),this.map.getView().getProjection(),"EPSG:4326");t=i[0],e=i[1]}else t=e=null;return{q:this.CACHE,lang:this.options.lang,limit:this.options.limit,lat:e,lon:t}}}),r=n.dom.create("div",null),a=n.dom.create("input","photon-input",r);Object.create(o)}return o.initialize(t,a,e),r},r=function(t){var e=i({},s.prototype,{options:{url:"http://photon.komoot.de/reverse/?",limit:1,handleResults:null},initialize:function(t){this.options=i({},this.options,t)},doReverse:function(t){var e=new CustomEvent("selected",{coordinates:t});document.dispatchEvent(e),this.coordinates=t,this.ajax(this.handleResults.bind(this),this)},_handleResults:function(){},handleResults:function(t){return(this.options.handleResults||this._handleResults).call(this,t)},getParams:function(){return{lang:this.options.lang,limit:this.options.limit,lat:this.coordinates[1],lon:this.coordinates[0]}}}),n=Object.create(e);return n.initialize(t),n},a={AddDomControl:function(t,e,i){var n=i||{},s=document.createElement("div");e&&(s.className=e),s.appendChild(t),ol.control.Control.call(this,{element:s,target:n.target})},Reverse:r,Search:o};ol.inherits(a.AddDomControl,ol.control.Control),e.exports=a},{"./utils":3,extend:1}],3:[function(t,e){var i=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},n=function(t){return i(t).split(/\s+/)},s={create:function(t,e,i){var n=document.createElement(t);return e&&(n.className=e),i&&i.appendChild(n),n},hasClass:function(t,e){if(void 0!==t.classList)return t.classList.contains(e);var i=s.getClass(t);return i.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i)},addClass:function(t,e){if(void 0!==t.classList)for(var i=n(e),o=0,r=i.length;r>o;o++)t.classList.add(i[o]);else if(!s.hasClass(t,e)){var a=s.getClass(t);s.setClass(t,(a?a+" ":"")+e)}},removeClass:function(t,e){void 0!==t.classList?t.classList.remove(e):s.setClass(t,i((" "+s.getClass(t)+" ").replace(" "+e+" "," ")))},setClass:function(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e},getClass:function(t){return void 0===t.className.baseVal?t.className:t.className.baseVal}},o={preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this},stop:function(t){var e=this.preventDefault(t);return e.stopPropagation(t)}};e.exports={dom:s,evt:o}},{}]},{},[2])(2)});